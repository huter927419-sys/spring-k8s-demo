# ============================================================================
# Ingress Configuration - Traefik Ingress Controller
# Ingress 配置 - Traefik Ingress 控制器
# ============================================================================
#
# This Ingress resource configures routing for both frontend and backend:
# - Frontend: Served at root path (/) with lower priority
# - Backend API: Served at /api path with higher priority (more specific)
# - TLS/HTTPS: Managed by cert-manager with Let's Encrypt
# - Automatic HTTP to HTTPS redirection via Traefik
#
# 该 Ingress 资源配置前端和后端的路由：
# - 前端：在根路径 (/) 提供服务，优先级较低
# - 后端 API：在 /api 路径提供服务，优先级较高（更具体）
# - TLS/HTTPS：由 cert-manager 使用 Let's Encrypt 管理
# - 通过 Traefik 自动从 HTTP 重定向到 HTTPS
#
# ============================================================================

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: spring-k8s-demo-ingress
  namespace: default
  annotations:
    # Cert-Manager: Use Let's Encrypt for TLS certificates
    # Cert-Manager：使用 Let's Encrypt 获取 TLS 证书
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # Traefik: Configure entrypoints and TLS
    # Traefik：配置入口点和 TLS
    traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
    # Priority: Lower priority for root path to allow more specific paths
    # 优先级：根路径使用较低优先级以允许更具体的路径
    traefik.ingress.kubernetes.io/router.priority: "1"
spec:
  ingressClassName: traefik
  # TLS Configuration / TLS 配置
  tls:
  - hosts:
    - flashswap09.online
    secretName: flashswap09-online-tls
  # Routing Rules / 路由规则
  rules:
  - host: flashswap09.online
    http:
      paths:
      # Backend API Route - Higher priority (more specific path)
      # 后端 API 路由 - 更高优先级（更具体的路径）
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: spring-k8s-demo-service
            port:
              number: 80
      # Frontend Route - Lower priority (catch-all for root path)
      # 前端路由 - 较低优先级（根路径的通用匹配）
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend-service
            port:
              number: 80
