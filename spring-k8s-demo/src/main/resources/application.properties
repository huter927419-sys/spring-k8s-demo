# ============================================================================
# Spring Boot Application Configuration
# Spring Boot 应用程序配置
# ============================================================================
#
# Performance Optimizations for Faster Startup / 性能优化以加快启动速度
# - Disable JMX for faster startup / 禁用 JMX 以加快启动
spring.jmx.enabled=false
# - Disable background pre-initialization / 禁用后台预初始化
spring.backgroundpreinitializer.ignore=true

# Application Name / 应用程序名称
spring.application.name=spring-k8s-demo

# Server Port / 服务器端口
server.port=8080

# ============================================================================
# Performance Optimization / 性能优化
# ============================================================================

# Lazy Initialization: Disable for faster startup / 延迟初始化：禁用以加快启动速度
spring.main.lazy-initialization=false

# JPA DataSource Initialization: Disable for faster startup / JPA 数据源初始化：禁用以加快启动速度
spring.jpa.defer-datasource-initialization=false

# ============================================================================
# Database Configuration / 数据库配置
# Note: Values can be overridden by environment variables / 注意：值可以通过环境变量覆盖
# ============================================================================

# MySQL Connection URL / MySQL 连接 URL
# - useSSL=false: Disable SSL for internal K8s communication / 禁用 SSL 用于内部 K8s 通信
# - allowPublicKeyRetrieval=true: Allow public key retrieval / 允许公钥检索
# - serverTimezone=UTC: Use UTC timezone / 使用 UTC 时区
# - rewriteBatchedStatements=true: Enable batch statement optimization / 启用批处理语句优化
spring.datasource.url=jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:springk8s}?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&rewriteBatchedStatements=true

# Database Credentials / 数据库凭据
spring.datasource.username=${DB_USER:root}
spring.datasource.password=${DB_PASSWORD:password}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# ============================================================================
# HikariCP Connection Pool Configuration / HikariCP 连接池配置
# ============================================================================

# Minimum idle connections - Reduced for faster startup / 最小空闲连接数 - 减少以加快启动
spring.datasource.hikari.minimum-idle=2

# Maximum pool size - Reduced for faster startup / 最大连接池大小 - 减少以加快启动
spring.datasource.hikari.maximum-pool-size=10

# Connection timeout - Reduced for faster startup (10 seconds) / 连接超时 - 减少以加快启动（10 秒）
spring.datasource.hikari.connection-timeout=10000

# Idle timeout (10 minutes) / 空闲超时（10 分钟）
spring.datasource.hikari.idle-timeout=600000

# Maximum lifetime (30 minutes) / 最大生存时间（30 分钟）
spring.datasource.hikari.max-lifetime=1800000

# Leak detection threshold (60 seconds) / 泄漏检测阈值（60 秒）
spring.datasource.hikari.leak-detection-threshold=60000

# ============================================================================
# JPA/Hibernate Configuration / JPA/Hibernate 配置
# ============================================================================

# DDL Auto: Update schema automatically / DDL 自动：自动更新架构
spring.jpa.hibernate.ddl-auto=update

# Show SQL: Disable in production / 显示 SQL：在生产环境中禁用
spring.jpa.show-sql=false

# Hibernate Dialect / Hibernate 方言
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Format SQL: Format SQL statements in logs / 格式化 SQL：在日志中格式化 SQL 语句
spring.jpa.properties.hibernate.format_sql=true

# Batch Size: Number of statements to batch / 批处理大小：批处理的语句数
spring.jpa.properties.hibernate.jdbc.batch_size=20

# Order Inserts: Order insert statements for better batching / 排序插入：排序插入语句以更好地批处理
spring.jpa.properties.hibernate.order_inserts=true

# Order Updates: Order update statements for better batching / 排序更新：排序更新语句以更好地批处理
spring.jpa.properties.hibernate.order_updates=true

# Open Session In View: Disable to prevent lazy loading issues / 在视图中打开会话：禁用以防止延迟加载问题
spring.jpa.open-in-view=false

# ============================================================================
# Spring Actuator Configuration / Spring Actuator 配置
# ============================================================================

# Exposed Endpoints / 暴露的端点
management.endpoints.web.exposure.include=health,info,metrics,prometheus

# Health Details / 健康详情
management.endpoint.health.show-details=when-authorized

# Kubernetes Probes / Kubernetes 探针
management.endpoint.health.probes.enabled=true

# Database Health Check / 数据库健康检查
management.health.db.enabled=true

# Redis Health Check / Redis 健康检查
management.health.redis.enabled=true

# Prometheus Metrics Export / Prometheus 指标导出
management.metrics.export.prometheus.enabled=true

# ============================================================================
# Redis Configuration / Redis 配置
# ============================================================================

# Redis Host / Redis 主机
spring.data.redis.host=${REDIS_HOST:localhost}

# Redis Port / Redis 端口
spring.data.redis.port=${REDIS_PORT:6379}

# Redis Password (empty by default) / Redis 密码（默认为空）
spring.data.redis.password=${REDIS_PASSWORD:}

# Connection Timeout / 连接超时
spring.data.redis.timeout=2000ms

# Lettuce Connection Pool / Lettuce 连接池
spring.data.redis.lettuce.pool.max-active=20
spring.data.redis.lettuce.pool.max-idle=10
spring.data.redis.lettuce.pool.min-idle=5
spring.data.redis.lettuce.pool.max-wait=2000ms

# ============================================================================
# Spring Cache Configuration / Spring Cache 配置
# ============================================================================

# Cache Type: Use Redis for caching / 缓存类型：使用 Redis 进行缓存
spring.cache.type=redis

# Cache TTL: 1 hour (3600000 milliseconds) / 缓存 TTL：1 小时（3600000 毫秒）
spring.cache.redis.time-to-live=3600000

# Cache Null Values: Disable caching null values / 缓存空值：禁用缓存空值
spring.cache.redis.cache-null-values=false

# Cache Key Prefix / 缓存键前缀
spring.cache.redis.key-prefix=cache:

# ============================================================================
# JWT Configuration / JWT 配置
# Note: Secret should be provided via Kubernetes Secret in production
# 注意：在生产环境中，密钥应通过 Kubernetes Secret 提供
# ============================================================================

# JWT Secret Key (from Kubernetes Secret) / JWT 密钥（来自 Kubernetes Secret）
jwt.secret=${JWT_SECRET:mySecretKeyForJWTTokenGenerationAndValidationShouldBeLongEnough}

# JWT Expiration Time (24 hours in milliseconds) / JWT 过期时间（24 小时，以毫秒为单位）
jwt.expiration=${JWT_EXPIRATION:86400000}

# ============================================================================
# Spring Security Configuration / Spring Security 配置
# ============================================================================

# Default Admin Username / 默认管理员用户名
spring.security.user.name=admin

# Default Admin Password / 默认管理员密码
spring.security.user.password=admin123

# ============================================================================
# CORS Configuration / CORS 配置
# ============================================================================

# Allowed Origins (comma-separated) / 允许的来源（逗号分隔）
cors.allowed-origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:8080}

# ============================================================================
# Logging Configuration / 日志配置
# ============================================================================

# Logging Levels / 日志级别
logging.level.com.example.demo=INFO
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO
logging.level.org.hibernate.SQL=WARN

# Console Log Pattern / 控制台日志模式
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# File Logging / 文件日志
logging.file.name=/app/logs/application.log
logging.file.max-size=100MB
logging.file.max-history=30

